# Start Electron changes
# Tweaks thanks to fransiscofranco and AK
service special_power /system/bin/sh /init.special_power.sh
    disabled
    class late_start
    user root
    group root
    oneshot

service chill /system/bin/sh /init.electron.sh
    disabled
    class late_strt
    user root
    group root
    oneshot

on property:sys.boot_completed=1
    # Re-enable retention idle state
    write /sys/module/lpm_levels/system/a53/cpu0/retention/idle_enabled 1
    write /sys/module/lpm_levels/system/a53/cpu1/retention/idle_enabled 1
    write /sys/module/lpm_levels/system/a53/cpu2/retention/idle_enabled 1
    write /sys/module/lpm_levels/system/a53/cpu3/retention/idle_enabled 1
    write /sys/module/lpm_levels/system/a57/cpu4/retention/idle_enabled 1
    write /sys/module/lpm_levels/system/a57/cpu5/retention/idle_enabled 1
    write /sys/module/lpm_levels/system/a53/a53-l2-retention/idle_enabled 1
    write /sys/module/lpm_levels/system/a57/a57-l2-retention/idle_enabled 1

    # Process Reclain
    write /sys/module/process_reclaim/parameters/enable_process_reclaim 1
    write /sys/module/process_reclaim/parameters/pressure_min 50
    write /sys/module/process_reclaim/parameters/pressure_max 70
    write /sys/module/process_reclaim/parameters/per_swap_size 512
    write /sys/module/process_reclaim/parameters/swap_opt_eff 30

    # Disable some Wlan wakelocks
    write /sys/module/wakeup/parameters/enable_wlan_rx_wake_ws 1
    write /sys/module/wakeup/parameters/enable_wlan_ctrl_wake_ws 1
    write /sys/module/wakeup/parameters/enable_wlan_wake_ws 1

    # Start Power tweaks
    start special_power

    # Set Electron profile for chill
    start chill

    # Initialize frequency hardlimits
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq_hardlimit
    chmod 0664 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq_hardlimit
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq_hardlimit 302400
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq_hardlimit
    chmod 0664 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq_hardlimit
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq_hardlimit 1555200
    chown system system /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq_hardlimit
    chmod 0664 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq_hardlimit
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq_hardlimit 384000
    chown system system /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq_hardlimit
    chmod 0664 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq_hardlimit
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq_hardlimit 1958400

    # Governor settings from soniCron

    # Little cluster settings - interactive - 384MHz min - 1708MHz max
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor interactive
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 384000
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1708800
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/go_hispeed_load 91
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/above_hispeed_delay 0
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/timer_rate 60000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/hispeed_freq 960000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/timer_slack 480000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/target_loads "80 460800:70 600000:99"
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/min_sample_time 0
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/boost 0
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/align_windows 1
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/use_migration_notif 1
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/use_sched_load 0
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/max_freq_hysteresis 0
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/boostpulse_duration 0

    # Big cluster settings - interactive - 633MHz min - 2054MHz max
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor interactive
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 633600
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 2054400
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/go_hispeed_load 91
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/above_hispeed_delay 0
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/timer_rate 30000
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/hispeed_freq 960000
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/timer_slack 480000
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/target_loads "70 960000:90 1440000:99"
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/min_sample_time 0
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/boost 0
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/align_windows 1
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/use_migration_notif 1
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/use_sched_load 0
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/max_freq_hysteresis 0
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/boostpulse_duration 0

    # Input boost settings: 600MHz on little for 1.92s
    write /sys/module/cpu_boost/parameters/input_boost_freq "0:600000 1:600000 2:600000 3:600000 4:0 5:0 6:0 7:0"
    write /sys/module/cpu_boost/parameters/boost_ms 0
    write /sys/module/cpu_boost/parameters/input_boost_ms 1920

    # Core control disabled, msm_thermal enabled
    write /sys/module/msm_thermal/core_control/enabled 0
    write /sys/module/msm_thermal/parameters/enabled Y
